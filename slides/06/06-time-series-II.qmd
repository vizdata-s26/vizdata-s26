---
title: Visualizing time series data II
subtitle: Lecture 6
format: revealjs
---

# Warm up

## Dataviz of the day {.smaller}

::: task
What, if anything, is wrong with the following visualization of median yearly total compensation for data scientists in the US by years of experience (Source: Glassdoor)?
:::

![](images/kdnuggets-data-science-salaries.png){width=630 fig-align="center"}

::: {.aside}
Source: [KDnuggets - Data Science Salaries & Job Market Analysis: From 2024 to 2025](https://www.kdnuggets.com/data-science-salaries-job-market-analysis-2024-2025)
:::

## Dataviz of the day - annotated

![](images/kdnuggets-data-science-salaries-annotated.png){fig-align="center"}

## Dataviz of the day - revisited

```{r}
#| label: kdnuggets-remake
#| message: false
#| code-fold: true
library(tidyverse)
library(scales)
ds_salaries <- tribble(
  ~experience , ~salary , ~label        ,
   0.5        ,  117276 , "0-1 years"   ,
   2          ,  128403 , "1-3 years"   ,
   5          ,  141390 , "4-6 years"   ,
   8          ,  152966 , "7-9 years"   ,
  12          ,  166818 , "10-14 years" ,
  15          ,  189884 , "15+ years"
)

p_kdnuggets <- ggplot(
  ds_salaries,
  aes(x = experience * 3, y = salary)
) +
  geom_text(
    aes(y = salary + 20000, label = str_to_upper(label)),
    color = "lightgray",
    fontface = "bold",
    size = 3
  ) +
  geom_text(
    aes(y = salary + 10000, label = dollar(salary)),
    color = "#75b6be",
    fontface = "bold",
    size = 4
  ) +
  theme_void() +
  theme(
    plot.background = element_rect(fill = "black"),
    plot.title = element_text(
      color = "#e8c95c",
      face = "bold",
      hjust = 0.5,
      size = 25
    ),
    axis.title.x = element_text(
      color = "white",
      size = 10,
      margin = margin(t = 2.5, b = 2.5, l = 0, r = 0)
    )
  ) +
  labs(
    x = "Median yearly total compensation for data scientists in the US by years of experience (Glassdoor)",
    y = NULL,
    title = "Data Science Salaries\nby Experience Level"
  )

p_kdnuggets +
  geom_col(width = 4, fill = "#e8c95c")
```  

## Dataviz of the day - revisited further
      
```{r}
#| code-fold: true
ggplot(
  ds_salaries,
  aes(x = experience * 3, y = salary)
) +
  geom_line(linewidth = 2, color = "#e8c95c") +
  geom_point(
    size = 4,
    color = "#e8c95c",
    fill = "black",
    shape = "circle filled",
    stroke = 2
  ) +
  labs(
    x = "Median yearly total compensation for data scientists in the US by years of experience (Glassdoor)",
    y = NULL,
    title = "Data Science Salaries\nby Experience Level"
  ) +
  geom_text(
    aes(y = salary + 15000, label = str_to_upper(label)),
    color = "lightgray",
    fontface = "bold",
    size = 3
  ) +
  geom_text(
    aes(y = salary + 10000, label = dollar(salary)),
    color = "#75b6be",
    fontface = "bold",
    size = 4
  ) +
  theme_void() +
  theme(
    plot.background = element_rect(fill = "black"),
    plot.title = element_text(
      color = "#e8c95c",
      face = "bold",
      hjust = 0.5,
      size = 25
    ),
    axis.title.x = element_text(
      color = "white",
      size = 10,
      margin = margin(t = 2.5, b = 2.5, l = 0, r = 0)
    )
  )
```

## Announcements

- HW 1 recap:
  - Those with failing actions got a chance to resolve without penalty (one-time-only!)
  - Late submissions: Due today at 5 pm

- Project 1 teams are posted at [`vizdata-s26/teams`](https://github.com/vizdata-s26/teams/blob/main/project-1-teams.csv)

- Tomorrow's lab:
  - Submit team name
  - Work on proposal
  - All team members must be there! If you have an excused absence, reach out to your team members today
  - Time permitting: Start HW 2

## Setup {.smaller}

```{r}
#| label: setup
#| message: false
# load packages
library(tidyverse)
library(scales)
library(ggthemes)
library(colorspace)
library(ggrepel)
library(ggpp) # enhances support for data labels + annotations
library(broom)
library(popthemes) # pak::pak("johnmackintosh/popthemes")

# set theme for ggplot2
ggplot2::theme_set(ggplot2::theme_minimal(base_size = 14))

# set figure parameters for knitr
knitr::opts_chunk$set(
  fig.width = 7, # 7" width
  fig.asp = 0.618, # the golden ratio
  fig.retina = 3, # dpi multiplier for displaying HTML output on retina
  fig.align = "center", # center align figures
  dpi = 300 # higher dpi, sharper image
)
```

# From last time

## Data: Unemployment {.smaller .scrollable}

```{r}
#| code-fold: true
#| code-summary: Data load and prep code
#| message: false
unemp_bachelor <- read_csv(here::here(
  "slides/06",
  "data/fred",
  "CGBD25O.csv"
)) |>
  rename(date = observation_date, unemp_rate = CGBD25O) |>
  mutate(degree = "Bachelor's")
unemp_master <- read_csv(here::here(
  "slides/06",
  "data/fred",
  "CGMD25O.csv"
)) |>
  rename(date = observation_date, unemp_rate = CGMD25O) |>
  mutate(degree = "Master's")
unemp_doctoral <- read_csv(here::here(
  "slides/06",
  "data/fred",
  "CGDD25O.csv"
)) |>
  rename(date = observation_date, unemp_rate = CGDD25O) |>
  mutate(degree = "Doctoral")
unemp <- bind_rows(unemp_bachelor, unemp_master, unemp_doctoral) |>
  mutate(degree = fct_relevel(degree, "Bachelor's", "Master's", "Doctoral"))
```

```{r}
unemp
```

## Unemployment for Bachelor's & Master's

::: task
In `ae-04`, finish recreating the following visualization.
:::

```{r}
#| label: connected-scatter
#| echo: false
#| warning: false
#| message: false
#| fig-width: 10
unemp_bachelor_master_wider <- unemp |>
  filter(degree %in% c("Bachelor's", "Master's")) |>
  pivot_wider(names_from = degree, values_from = unemp_rate)

recession_end_dates <- c(
  ymd("2001-11-01"),
  ymd("2009-06-01"),
  ymd("2020-04-01")
)
endpoints <- c(
  ymd("2000-01-01"),
  ymd("2025-12-01")
)
gray_dark_hex <- "#595959"
gray_light_hex <- "#737373"

ggplot(unemp_bachelor_master_wider, aes(x = `Bachelor's`, y = `Master's`)) +
  geom_line(
    aes(color = date),
    linewidth = 1,
    alpha = 0.5,
    show.legend = FALSE
  ) +
  scale_x_continuous(
    labels = label_percent(scale = 1),
    breaks = seq(0, 10, 2),
    limit = c(0, 12)
  ) +
  scale_y_continuous(
    labels = label_percent(scale = 1),
    breaks = seq(0, 10, 2),
    limit = c(0, 8)
  ) +
  geom_text_repel(
    data = unemp_bachelor_master_wider |>
      filter(date %in% recession_end_dates),
    aes(label = as.character(format(date, "%b %e, %Y"))),
    position = ggpp::position_nudge_keep(x = 2)
  ) +
  # recessions
  geom_text_repel(
    data = unemp_bachelor_master_wider |>
      filter(date %in% endpoints),
    aes(
      label = paste(
        as.character(format(date, "%b %e, %Y")),
        c("(Start date)", "(End date)")
      )
    ),
    position = ggpp::position_nudge_keep(x = 3, y = -1),
    color = gray_dark_hex
  ) +
  annotate(
    geom = "label",
    x = 4,
    y = 6.5,
    label = str_wrap(
      "Dates annotated in black indicate end dates of U.S. recessions determined by the National Bureau of Economic Research (NBER).",
      30
    ),
    size = 3,
    hjust = 0,
    fill = "white"
  ) +
  # endpoints
  annotate(
    geom = "label",
    x = 8,
    y = 1,
    label = str_wrap(
      "Dates annotated in gray indicate start and end dates of the data.",
      25
    ),
    size = 3,
    hjust = 0,
    fill = "white",
    color = gray_dark_hex
  ) +
  # diagonal
  geom_abline(
    slope = 1,
    intercept = 0,
    linetype = "dotted",
    color = gray_light_hex
  ) +
  annotate(
    geom = "segment",
    x = 8,
    xend = 8.8,
    y = 8,
    yend = 8,
    linewidth = 0.2,
    color = gray_light_hex
  ) +
  annotate(
    geom = "label",
    x = 9,
    y = 8,
    label = str_wrap(
      "Dotted line represents equal unemployment rate for Master's and Bachelor's degree holders.",
      30
    ),
    size = 3,
    hjust = 0,
    fill = gray_light_hex,
    color = "white"
  ) +
  labs(
    title = "Unemployment rate",
    subtitle = "25 years and over",
    x = "Bachelor's degree holders",
    y = "Master's degree holders",
    caption = "Source: U.S. Bureau of Labor Statistics via FRED"
  ) +
  theme(plot.caption = element_text(color = "darkgray", hjust = 0)) +
  coord_equal(clip = "off")
```

## Livecoding {.smaller}

Code developed during live coding session to be posted after class.

<!--

Reveal below for code developed during live coding session.

```{r}
#| ref.label: connected-scatter
#| fig-show: hide
#| code-fold: true
```

-->

## Critical requirements

Connected scatter plots **require**:

1.  Clear directional indicators (arrows, color gradients)
2.  Temporal scale information
3.  Careful annotation

Without these elements, the visualization becomes confusing.

# Recap

## Choosing the right approach

The choice depends on:

-   **Data characteristics**: Density, regularity, number of series
-   **Analytical goals**: Trends vs. individual values
-   **Audience familiarity**: Connected scatter plots require more reader sophistication

## Takeaways

-   Time imposes structure -- use it with connected visualizations
-   Progress from points → lines → areas based on data density and goals
-   For multiple series, use direct labeling over legends
-   Connected scatter plots reveal cyclical patterns but require careful design
-   Always consider whether lines represent data or interpolation

# Working with dates

## Reminder: Air Quality Index

-   The AQI is the Environmental Protection Agency's index for reporting air quality

-   Higher values of AQI indicate worse air quality

[![](images/aqi-levels.png){fig-alt="AQI Basics for Ozone and Particle Pollution"}](https://www.airnow.gov/aqi-basics)

::: aside
Source: https://www.airnow.gov/aqi-basics
:::

## AQI data

-   Source: [EPA's Daily Air Quality Tracker](https://www.epa.gov/outdoor-air-quality-data/air-data-daily-air-quality-tracker)

-   2016 - 2025 AQI (Ozone and PM2.5 combined) for Durham-Chapel Hill, NC core-based statistical area (CBSA), one file per year

-   2016 - 2025 AQI (Ozone and PM2.5 combined) for San Francisco-Oakland-Hayward, CA CBSA, one file per year

## 2025 Durham-Chapel Hill

```{r}
#| label: dch-2025-3-data-prep
#| echo: false
#| message: false
dch_2025 <- read_csv(
  here::here(
    "slides/06/",
    "data/durham-chapel-hill/ad_aqi_tracker_data-2025.csv"
  )
) |>
  janitor::clean_names()
```

```{r}
dim(dch_2025)
names(dch_2025)
```

## First look

::: task
This plot looks quite bizarre. What might be going on?
:::

```{r}
ggplot(dch_2025, aes(x = date, y = aqi_value, group = 1)) +
  geom_line()
```

## Peek at data

```{r}
dch_2025 |>
  select(date, aqi_value, site_name, site_id)
```

## Transforming date {.smaller}

Using `lubridate::mdy()`:

```{r}
dch_2025 |>
  mutate(date = mdy(date))
```

## Transforming AQI values {.smaller}

::: task
What does this warning mean?
:::

```{r}
dch_2025 |>
  mutate(aqi_value = as.numeric(aqi_value))
```

## Investigating AQI values

-   Take a peek at distinct values of AQI

```{r}
dch_2025 |>
  distinct(aqi_value) |>
  pull()
```

-   `"."` likely indicates `NA`, and it's causing the entire column to be read in as characters

## Rewind, and start over {.smaller}

```{r}
#| message: false
dch_2025 <- read_csv(
  here::here(
    "slides/06",
    "data/durham-chapel-hill/ad_aqi_tracker_data-2022.csv"
  ),
  na = c(".", "")
) |>
  janitor::clean_names() |>
  mutate(date = mdy(date))

glimpse(dch_2025)
```

## Another look

```{r}
#| label: dch-2025-1
#| fig-asp: 0.4
ggplot(dch_2025, aes(x = date, y = aqi_value, group = 1)) +
  geom_line()
```

## What's missing?

::: task
What's missing in this plot?
:::

```{r}
#| echo: false
#| fig-width: 8
#| fig-asp: 0.5
dch_2025 |>
  ggplot(aes(x = date, y = aqi_value, group = 1)) +
  geom_line(linewidth = 0.8) +
  labs(
    x = NULL,
    y = "AQI",
    title = "Ozone and PM2.5 Daily AQI Values",
    subtitle = "Durham-Chapel Hill, NC",
    caption = "\nSource: EPA Daily Air Quality Tracker"
  )
```

## Filling in the gaps

::: panel-tabset
## Option 1

```{r}
#| label: fill-in-gaps-1
#| echo: false
#| fig-width: 8
#| fig-asp: 0.3
dch_2025 |>
  filter(!is.na(aqi_value)) |>
  ggplot(aes(x = date, y = aqi_value, group = 1)) +
  geom_line(linewidth = 0.8) +
  labs(
    x = NULL,
    y = "AQI",
    title = "Ozone and PM2.5 Daily AQI Values",
    subtitle = "Durham-Chapel Hill, NC",
    caption = "\nSource: EPA Daily Air Quality Tracker"
  )
```

## Option 2

```{r}
#| label: fill-in-gaps-2
#| echo: false
#| fig-width: 8
#| fig-asp: 0.3
dch_2025 |>
  mutate(
    impute = if_else(is.na(aqi_value), TRUE, FALSE),
    impute = if_else(is.na(lead(aqi_value)), TRUE, impute),
    aqi_value = if_else(
      is.na(aqi_value),
      (lag(aqi_value) + lead(aqi_value)) / 2,
      aqi_value
    )
  ) |>
  ggplot(aes(x = date, y = aqi_value, group = 1)) +
  geom_line(
    aes(color = impute),
    show.legend = FALSE,
    linewidth = 0.8
  ) +
  scale_color_manual(values = c("black", "cornflowerblue")) +
  labs(
    x = NULL,
    y = "AQI",
    title = "Ozone and PM2.5 Daily AQI Values",
    subtitle = "Durham-Chapel Hill, NC",
    caption = "\nSource: EPA Daily Air Quality Tracker"
  )
```

:::

## Filling in the gaps - Code

::: panel-tabset
## Option 1

```{r}
#| label: fill-in-gaps-1
#| fig-show: hide
#| code-line-numbers: "|2"
```

## Option 2

```{r}
#| label: fill-in-gaps-2
#| fig-show: hide
#| code-line-numbers: "|2-10"
```

:::

# Calculating cumulatives

## Cumulatives over time

-   When visualizing time series data, a somewhat common task is to calculate cumulatives over time and plot them

-   In our example we'll calculate the number of days with "good" AQI ($\le$ 50) and plot that value on the y-axis and the date on the x-axis

## Calculating cumulatives

Step 1. Arrange your data

```{r}
dch_2025 |>
  select(date, aqi_value) |>
  filter(!is.na(aqi_value)) |>
  arrange(date)
```

## Calculating cumulatives

Step 2. Identify good days

```{r}
dch_2025 |>
  select(date, aqi_value) |>
  filter(!is.na(aqi_value)) |>
  arrange(date) |>
  mutate(good_aqi = if_else(aqi_value <= 50, 1, 0))
```

## Calculating cumulatives {.scrollable}

Step 3. Sum over time

```{r}
dch_2025 |>
  select(date, aqi_value) |>
  filter(!is.na(aqi_value)) |>
  arrange(date) |>
  mutate(
    good_aqi = if_else(aqi_value <= 50, 1, 0),
    cumsum_good_aqi = cumsum(good_aqi)
  ) |>
  print(n = 30)
```

## Plotting cumulatives {.smaller}

::: panel-tabset
### Plot

```{r}
#| label: durham-aqi-3
#| echo: false
#| fig.asp: 0.5

dch_2025 |>
  select(date, aqi_value) |>
  filter(!is.na(aqi_value)) |>
  arrange(date) |>
  mutate(
    good_aqi = if_else(aqi_value <= 50, 1, 0),
    cumsum_good_aqi = cumsum(good_aqi)
  ) |>
  ggplot(aes(x = date, y = cumsum_good_aqi, group = 1)) +
  geom_line() +
  scale_x_date(date_labels = "%b %Y") +
  labs(
    x = NULL,
    y = "Number of days",
    title = "Cumulative number of good AQI days (AQI < 50)",
    subtitle = "Durham-Chapel Hill, NC",
    caption = "\nSource: EPA Daily Air Quality Tracker"
  ) +
  theme(plot.title.position = "plot")
```

### Code

```{r}
#| ref.label: durham-aqi-3
#| fig-show: hide
```

:::

# Detrending

## Detrending

-   Detrending is removing prominent long-term trend in time series to specifically highlight any notable deviations

-   Let's demonstrate using multiple years of AQI data

## Multiple years of Durham-Chapel Hill data {.smaller}

```{r}
dch_files <- fs::dir_ls(here::here("slides/06", "data/durham-chapel-hill"))
dch_files
```

## Reading multiple files {.smaller}

```{r}
#| message: false
dch <- map_dfr(
  dch_files,
  ~ read_csv(.x, na = c(".", ""), col_select = Date:Source)
)

dch <- dch |>
  janitor::clean_names() |>
  mutate(
    date = mdy(date),
    good_aqi = if_else(aqi_value <= 50, 1, 0)
  ) |>
  filter(!is.na(aqi_value)) |>
  arrange(date) |>
  mutate(cumsum_good_aqi = cumsum(good_aqi), .after = aqi_value)

dch
```

## Plot trend since 2016 {.smaller}

::: panel-tabset
### Plot

```{r}
#| label: dch-3
#| echo: false
#| fig-asp: 0.5
#| warning: false

dch |>
  ggplot(aes(x = date, y = cumsum_good_aqi, group = 1)) +
  geom_smooth(method = "lm", color = "pink") +
  geom_line() +
  scale_x_date(
    expand = expansion(mult = 0.07),
    date_labels = "%Y"
  ) +
  labs(
    x = NULL,
    y = "Number of days",
    title = "Cumulative number of good AQI days (AQI < 50)",
    subtitle = "Durham-Chapel Hill, NC",
    caption = "\nSource: EPA Daily Air Quality Tracker"
  ) +
  theme(plot.title.position = "plot")
```

### Code

```{r}
#| ref.label: dch-3
#| fig-show: hide
#| code-line-numbers: "|6|7"
```

:::

## Detrend

Step 1. Fit a simple linear regression

```{r}
m <- lm(cumsum_good_aqi ~ date, data = dch)

m
```

## Detrend {.smaller}

Step 2. Augment the data with model results (using `broom::augment()`)

```{r}
dch_aug <- augment(m)

dch_aug
```

## Detrend

Step 3. Divide the observed value of `cumsum_good_aqi` by the respective value in the long-term trend (i.e., `.fitted`)

```{r}
dch_aug <- dch_aug |>
  mutate(ratio = cumsum_good_aqi / .fitted, .after = .fitted)

dch_aug
```

## Visualize detrended data {.smaller}

::: panel-tabset
### Plot

```{r}
#| label: dch-4
#| echo: false
#| fig-asp: 0.5
dch_aug |>
  ggplot(aes(x = date, y = ratio, group = 1)) +
  geom_hline(yintercept = 1, color = "gray") +
  geom_line() +
  scale_x_date(
    expand = expansion(mult = 0.07),
    date_labels = "%Y"
  ) +
  labs(
    x = NULL,
    y = "Number of days\n(detrended)",
    title = "Cumulative number of good AQI days (AQI < 50)",
    subtitle = "Durham-Chapel Hill, NC",
    caption = "\nSource: EPA Daily Air Quality Tracker"
  ) +
  # title aligned to the entire plot (minus any space for margins and plot tag)
  theme(plot.title.position = "plot")
```

### Code

```{r}
#| ref.label: dch-4
#| fig-show: hide
#| code-line-numbers: "|3|16-17"
```

:::

## Air Quality in Durham

<br><br>

::: hand
barely anything interesting happening!
:::

. . .

::: hand
let's look at data from somewhere with a bit more "interesting" air quality data...
:::

## Read in multiple years of SF data {.smaller .scrollable}

```{r}
#| message: false
sf_files <- fs::dir_ls(here::here("slides/06/", "data/san-francisco"))

sf <- map_dfr(
  sf_files,
  ~ read_csv(.x, na = c(".", ""), col_select = Date:Source)
)

sf <- sf |>
  janitor::clean_names() |>
  mutate(
    date = mdy(date),
    good_aqi = if_else(aqi_value <= 50, 1, 0)
  ) |>
  filter(!is.na(aqi_value)) |>
  arrange(date) |>
  mutate(
    cumsum_good_aqi = cumsum(good_aqi),
    .after = aqi_value
  )

sf
```

## Plot trend since 2016 - good AQI {.smaller}

::: panel-tabset
### Plot

```{r}
#| label: sf-1
#| echo: false
#| fig-asp: 0.5
#| warning: false
sf |>
  ggplot(aes(x = date, y = cumsum_good_aqi, group = 1)) +
  geom_smooth(method = "lm", color = "pink") +
  geom_line() +
  scale_x_date(
    expand = expansion(mult = 0.07),
    date_labels = "%Y"
  ) +
  labs(
    x = NULL,
    y = "Number of days",
    title = "Cumulative number of good AQI days (AQI < 50)",
    subtitle = "San Francisco-Oakland-Hayward, CA",
    caption = "\nSource: EPA Daily Air Quality Tracker"
  ) +
  theme(plot.title.position = "plot")
```

### Code

```{r}
#| ref.label: sf-1
#| fig-show: hide
```

:::

## Detrend

1.  Fit a simple linear regression

```{r}
m_sf <- lm(cumsum_good_aqi ~ date, data = sf)
```

. . .

2.  Augment the data with model results

```{r}
sf_aug <- augment(m_sf)
```

. . .

3.  Divide the observed value of `cumsum_good_aqi` by the respective value in the long-term trend (i.e., `.fitted`)

```{r}
sf_aug <- sf_aug |>
  mutate(ratio = cumsum_good_aqi / .fitted, .after = .fitted)
```

## Visualize detrended data

::: panel-tabset
### Plot

```{r}
#| label: sf-2
#| echo: false
#| fig-asp: 0.5
sf_aug |>
  ggplot(aes(x = date, y = ratio, group = 1)) +
  geom_hline(yintercept = 1, color = "gray") +
  geom_line() +
  scale_x_date(
    expand = expansion(mult = 0.07),
    date_labels = "%Y"
  ) +
  labs(
    x = NULL,
    y = "Number of days\n(detrended)",
    title = "Cumulative number of good AQI days (AQI < 50)",
    subtitle = "San Francisco-Oakland-Hayward, CA",
    caption = "\nSource: EPA Daily Air Quality Tracker"
  ) +
  theme(plot.title.position = "plot")
```

### Code

```{r}
#| ref.label: sf-2
#| fig-show: hide
```

:::

## Detrending

-   In step 2 we fit a very simple model

-   Depending on the complexity you're trying to capture you might choose to fit a much more complex model

-   You can also decompose the trend into multiple trends, e.g. monthly, long-term, seasonal, etc.

::: aside
Interested in learning more? Take STA 344 - Spatio-temporal analysis!
:::

# Lag and lead

## Lag and lead {.smaller}

- `lag()`: "previous" value in a vector (likely also in time)
- `lead()`: "next" value in a vector
- Useful for comparing values behind of or ahead of the current values.

```{r}
dch_2025 |>
  slice_head(n = 10) |>
  mutate(
    aqi_lag = lag(aqi_value),
    aqi_lead = lead(aqi_value)
  ) |>
  select(date, contains("aqi"))
```

## Lag and lead further {.smaller}

```{r}
dch_2025 |>
  slice_head(n = 10) |>
  mutate(
    aqi_lag_1 = lag(aqi_value),
    aqi_lag_2 = lag(aqi_value, n = 2),
    aqi_lead_1 = lead(aqi_value),
    aqi_lead_3 = lead(aqi_value, n = 3),
  ) |>
  select(date, contains("aqi"))
```

# Gantt chart

## Gantt chart

Generally, a horizontal bar chart that illustrates a project schedule. 

![](images/gantt.png){width=700 fig-align="center"}

::: aside
Souce: [Wikipedia](https://en.wikipedia.org/wiki/Gantt_chart)
:::

## Or...

```{r}
#| label: scientists-gantt-read-transform
#| echo: false
#| message: false
professions <- read_csv(here::here(
  "slides/06",
  "data/scientists/professions.csv"
))
dates <- read_csv(here::here("slides/06", "data/scientists/dates.csv"))
works <- read_csv(here::here("slides/06", "data/scientists/works.csv"))

scientists <- professions |>
  left_join(dates, by = join_by(name)) |>
  left_join(works, by = join_by(name))

scientists_longer <- scientists |>
  mutate(
    birth_year = case_when(
      name == "Ada Lovelace" ~ 1815,
      name == "Marie Curie" ~ 1867,
      TRUE ~ birth_year
    ),
    death_year = case_when(
      name == "Ada Lovelace" ~ 1852,
      name == "Marie Curie" ~ 1934,
      TRUE ~ death_year
    ),
    status = if_else(is.na(death_year), "alive", "deceased"),
    death_year = if_else(is.na(death_year), 2027, death_year),
    known_for = if_else(
      name == "Rosalind Franklin",
      "understanding of the molecular structures of DNA ",
      known_for
    )
  ) |>
  pivot_longer(
    cols = contains("year"),
    names_to = "year_type",
    values_to = "year"
  ) |>
  mutate(death_year_fake = if_else(year == 2027, TRUE, FALSE))
```

```{r}
#| label: scientists-gantt-plot
#| echo: false
#| fig-asp: 0.6
#| out-width: "100%"
#| fig-width: 12
#| warning: false
ggplot(
  scientists_longer,
  aes(
    x = year,
    y = fct_reorder(name, as.numeric(factor(profession))),
    group = name,
    color = profession
  )
) +
  geom_point(aes(shape = death_year_fake), show.legend = FALSE) +
  geom_line(aes(linetype = status), show.legend = FALSE) +
  geom_text(
    aes(y = name, label = str_wrap(known_for, 50)),
    x = 2030,
    show.legend = FALSE,
    hjust = 0,
    size = 4
  ) +
  geom_text(
    aes(label = profession),
    x = 1809,
    y = Inf,
    hjust = 1,
    vjust = 1,
    show.legend = FALSE,
    fontface = "bold"
  ) +
  scale_shape_manual(values = c("circle", NA)) +
  scale_linetype_manual(values = c("dashed", "solid")) +
  scale_color_manual(values = pop_palette("aqua")) +
  scale_x_continuous(expand = c(0.01, 0), breaks = seq(1820, 2026, 40)) +
  coord_cartesian(clip = "off") +
  facet_grid(
    profession ~ .,
    scales = "free_y",
    space = "free_y",
    switch = "x"
  ) +
  labs(
    x = "Year",
    y = NULL,
    title = "10 women in science who changed the world",
    caption = "Source: Discover magazine"
  ) +
  theme_gray(base_size = 14) +
  theme(
    plot.margin = unit(c(1, 20, 1, 10), "lines"),
    plot.title.position = "plot",
    plot.caption.position = "plot",
    plot.caption = element_text(hjust = 1.7), # manual hack
    strip.background = element_blank(),
    strip.text = element_blank(),
    axis.title.x = element_text(hjust = 0),
    panel.grid.minor = element_blank()
  )
```

## [Time permitting] Livecoding

::: task

Time permitting: Recreate the gantt chart in the previous slide in `ae-05`.

:::

Code developed during live coding session to be posted after class.

<!--

## Just in case... {.smaller .scrollable}

Reveal below for code developed during live coding session.

```{r}
#| ref.label: scientists-gantt-read-transform
#| fig-show: hide
#| code-fold: true
#| code-summary: Transform
#| message: false
```

```{r}
#| ref.label: scientists-gantt-plot
#| fig-show: hide
#| code-fold: true
#| warning: false
#| code-summary: Plot
```

-->
